{% extends 'layout.html' %}
{% load static %}

{% block content %}
    <div class="row">
        <div class="card" style="width: 100%;height: auto">
            <div class="card-header">
                <strong>迭代缺陷分布图</strong>
            </div>
            <div class="card-body">
                <div id="main-1" style="height:400px;width: 100%; padding-top: 20px;float: left"></div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="card" style="width: 100%;height: auto">
            <div class="card-header">
                工单情况
            </div>
            <div class="card-body">
                <div id="main-2" style="height:400px;width: 100%; padding-top: 20px;float: left"></div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="card" style="width: 100%;height: auto">
            <div class="card-header">
                xxx情况
            </div>
            <div class="card-body">
                <div id="main-3" style="height:400px;width: 100%; padding-top: 20px;float: left"></div>
            </div>
        </div>
    </div>



{% endblock %}

{% block js %}
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/map/js/china.js"></script>

    <script type="text/javascript">

        $(function () {
            initBar1();
            initBar2();
            initBar3();
        })

        function initBar1() {
            // 基于准备好的dom，初始化echarts实例
            var myChart = echarts.init(document.getElementById('main-1'));

            window.addEventListener('resize', function () {
                myChart.resize();
            });

            // 指定图表的配置项和数据
            var option = {
                // 全局调色盘。
                color: [
                    '#c23531',
                    '#2f4554',
                    '#61a0a8',
                    '#d48265',
                    '#91c7ae',
                    '#749f83',
                    '#ca8622',
                    '#bda29a',
                    '#6e7074',
                    '#546570',
                    '#c4ccd3'
                ],

                title: {
                    text: '员工业绩阅读汇总信息',
                    textAlign: "auto",
                    left: "center",
                },
                tooltip: {},
                legend: {
                    data: [],  // 后台获取
                    bottom: 0,
                    orient: 'vertical',
                    left: 10,
                    top: 'center'
                },
                xAxis: {
                    data: []  // 后台获取
                },
                yAxis: {},
                series: []  // 后台获取
            };

            $.ajax({
                url: "/test/bar1/",
                type: "get",
                dataType: "JSON",
                success: function (res) {
                    // 将后台返回的数据，更新到option中。
                    if (res.status) {
                        option.legend.data = res.data.legend;
                        option.xAxis.data = res.data.x_axis;
                        option.series = res.data.series_list;

                        // 使用刚指定的配置项和数据显示图表。
                        myChart.setOption(option);
                    }
                }
            })

            // 使用刚指定的配置项和数据显示图表。
            myChart.setOption(option);
        }

        function initBar2() {
            // 基于准备好的dom，初始化echarts实例
            var myChart = echarts.init(document.getElementById('main-3'));

            window.addEventListener('resize', function () {
                myChart.resize();
            });

            // 指定图表的配置项和数据
            var option = {
                title: {
                    text: '员工业绩阅读汇总信息',
                    textAlign: "auto",
                    left: "center",
                },
                tooltip: {},
                legend: {
                    data: [],  // 后台获取
                    bottom: 0
                },
                xAxis: {
                    data: []  // 后台获取
                },
                yAxis: {},
                series: []  // 后台获取
            };

            $.ajax({
                url: "/test/bar2/",
                type: "get",
                dataType: "JSON",
                success: function (res) {
                    // 将后台返回的数据，更新到option中。
                    if (res.status) {
                        option.legend.data = res.data.legend;
                        option.xAxis.data = res.data.x_axis;
                        option.series = res.data.series_list;

                        // 使用刚指定的配置项和数据显示图表。
                        myChart.setOption(option);
                    }
                }
            })

            // 使用刚指定的配置项和数据显示图表。
            myChart.setOption(option);
        }

        function initBar3() {
            {% comment %}
                参考网址：https://blog.csdn.net/u014361280/article/details/121457228
            {% endcomment %}

            var dataList = [
                {% comment %} {
                     name: "南海诸岛", value:
                         0
                 },
                 {
                     name: '北京', value:
                         0
                 },
                 {
                     name: '天津', value:
                         0
                 },
                 {
                     name: '上海', value:
                         0
                 },
                 {
                     name: '重庆', value:
                         0
                 },
                 {
                     name: '河北', value:
                         0
                 },
                 {
                     name: '河南', value:
                         0
                 },
                 {
                     name: '云南', value:
                         0
                 },
                 {
                     name: '辽宁', value:
                         0
                 },
                 {
                     name: '黑龙江', value:
                         0
                 },
                 {
                     name: '湖南', value:
                         0
                 },
                 {
                     name: '安徽', value:
                         0
                 },
                 {
                     name: '山东', value:
                         0
                 },
                 {
                     name: '新疆', value:
                         0
                 },
                 {
                     name: '江苏', value:
                         0
                 },
                 {
                     name: '浙江', value:
                         0
                 },
                 {
                     name: '江西', value:
                         0
                 },
                 {
                     name: '湖北', value:
                         0
                 },
                 {
                     name: '广西', value:
                         0
                 },
                 {
                     name: '甘肃', value:
                         0
                 },
                 {
                     name: '山西', value:
                         0
                 },
                 {
                     name: '内蒙古', value:
                         0
                 },
                 {
                     name: '陕西', value:
                         0
                 },
                 {
                     name: '吉林', value:
                         0
                 },
                 {
                     name: '福建', value:
                         0
                 },
                 {
                     name: '贵州', value:
                         0
                 },
                 {
                     name: '广东', value:
                         0
                 },
                 {
                     name: '青海', value:
                         0
                 },
                 {
                     name: '西藏', value:
                         0
                 },
                 {
                     name: '四川', value:
                         20
                 },
                 {
                     name: '宁夏', value:
                         0
                 },
                 {
                     name: '海南', value:
                         0
                 },
                 {
                     name: '台湾', value:
                         0
                 },
                 {
                     name: '香港', value:
                         0
                 },
                 {
                     name: '澳门', value:
                         0
                 }{% endcomment %}
            ]
            var myChart = echarts.init(document.getElementById('main-2'), 'macarons');

            var convertData = function (data) {
                var res = [];
                for (var i = 0; i < data.length; i++) {
                    var geoCoord = geoCoordMap[data[i].name];
                    if (geoCoord) {
                        res.push(geoCoord.concat(data[i].value));
                    }
                }
                return res;
            };

            option = {
                tooltip: {
                    position: function (point, params, dom, rect, size) {
                        // 鼠标坐标和提示框位置的参考坐标系是：以外层div的左上角那一点为原点，x轴向右，y轴向下
                        // 提示框位置
                        var x = 0; // x坐标位置
                        var y = 0; // y坐标位置

                        // 当前鼠标位置
                        var pointX = point[0];
                        var pointY = point[1];

                        // 外层div大小
                        // var viewWidth = size.viewSize[0];
                        // var viewHeight = size.viewSize[1];

                        // 提示框大小
                        var boxWidth = size.contentSize[0];
                        var boxHeight = size.contentSize[1];

                        // boxWidth > pointX 说明鼠标左边放不下提示框
                        if (boxWidth > pointX) {
                            x = 5;
                        } else { // 左边放的下
                            x = pointX - boxWidth;
                        }

                        // boxHeight > pointY 说明鼠标上边放不下提示框
                        if (boxHeight > pointY) {
                            y = 5;
                        } else { // 上边放得下
                            y = pointY - boxHeight;
                        }

                        return [x, y];

                    },
                    backgroundColor: "#c8d4e1",
                    formatter: function (params, ticket, callback) {
                        if (params.value)
                            return params.seriesName + '<br />' + params.name + '：' + params.value
                        else
                            return params.seriesName + '<br />' + params.name + '：' + '暂无数据'
                    }//数据格式化
                },
                visualMap: {
                    min: 0,
                    max: null,
                    left: 'left',
                    top: 'bottom',
                    splitNumber: 5,
                    color: ['#d32033', '#eac736', '#50a3ba'],
                    textStyle: {
                        color: '#000000'
                    },
                    {% comment %}show: true//图注{% endcomment %}
                },
                geo: {
                    map: 'china',
                    roam: false,//不开启缩放和平移
                    zoom: 1.23,//视角缩放比例
                    label: {
                        normal: {
                            show: true,
                            fontSize: '10',
                            color: 'rgba(0,0,0,0.7)'
                        }
                    },
                    itemStyle: {
                        normal: {
                            borderColor: 'rgba(0, 0, 0, 0.2)'
                        },
                        emphasis: {
                            areaColor: '#F3B329',//鼠标选择区域颜色
                            shadowOffsetX: 0,
                            shadowOffsetY: 0,
                            shadowBlur: 20,
                            borderWidth: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                },
                toolbox: {
                    show: true,
                    feature: {
                        mark: {show: true},
                        dataView: {show: true, readOnly: true},
                        saveAsImage: {show: true}
                    }
                },
                series: [
                    {
                        name: '工单数量',
                        type: 'map',
                        geoIndex: 0,
                        data: dataList
                    }
                ]
            };
            $.ajax({
                url: "/test/bar3/",
                type: "get",
                dataType: "JSON",
                success: function (res) {
                    // 将后台返回的数据，更新到option中。
                    if (res.status) {
                        {#//横轴#}
                        {#option.xAxis[0].data = res.data.x_axis;#}
                        {##}
                        dataList = res.data.series_list;
                        option.visualMap.max = res.data.max_value

                        // 使用刚指定的配置项和数据显示图表。
                        myChart.setOption(option);
                    }
                }
            })

            myChart.setOption(option);

            myChart.on('click', function (params) {
                alert(params.name);
            });

            setTimeout(function () {
                myChart.setOption({
                    series: [
                        {
                            name: '工单数量',
                            type: 'map',
                            geoIndex: 0,
                            data: dataList
                        }
                    ]
                });
            }, 1000)
        }

    </script>

{% endblock %}